EasyTravel Bot

Данный бот создан в рамках промежуточного дипломного проекта

Основные библиотеки: 

    pyTelegramBotAPI - библиотека для реализации бота методом long pooling, а 
    также работы с api Telegram
    
    asyncio - библиотека для реализации асинхронного функционала
    
    aiohttp - библиотека для формирования запросов к внешнему ресурсу с 
    асинхронным функционалом
    
    sqlalchemy - библиотека для работы с базами данных, использовался 
    асинхронный подход, структура базы данных написана в orm стиле
    
    alembic - библиотека-дополнение к sqlalchemy; для реализации миграций
    
    Для кэш памяти использовалась встроенная - StatePickleStorage
    
    Для базы данных выбрана SQLite3 

Важно: для получения дат посещения отелей используются сторонняя библиотека:

python-telegram-bot-calendar

Полный список библиотек, находится в файле requirements.txt

Особенности реализации:

При добавлении новых моделей для базы данных необходимо указывать название 
каждой в списке REGISTERED_MODELS_FOR_BOT в модуле bot_models.py.
Это необходимо корректной проверки базы данных при запуске бота

При запуске бота значала происходит проверка наличия и корректности схемы 
базы даннных.

Для этого реализован класс DbChecker в модуле db_checker.py

Для корректной проверки в модуле main.py, в блоке "if __name__ == '__main__'"
необходимо указать название файла базы данных. Остальная проверка проходит 
автоматически

middleware.py - в данном модуле реализован блок middleware. Я прописал две 
опции: 

    FormMiddleware - необходима для сбора данных для запроса 

    AntiFloodMiddleware - контроллирует количество сообщений, если параметр 
       превышен, то шлёт отбивку

form_parameters.py - в данном модуле прописаны скрипты для сбора параметров 
   запроса

command_operating.py - данной модуль содержит в себе классы для запуска 
   операций после сбора параметров, например запросы к внешнему источнику 
   или к внутренней базе данных


Инструкция по применению:

Бот запускается через файл main.py

Зависимости, такие как api ключи бота и внешнего ресурса, должны быть 
заранее прописаны в файле .env

Для работы с переменными средами используется библиотека: python-decouple

Содержание файла .env:

    bot_token = ''
    объявляется в модуле main.py

    hotels_api_token = ''
    объявляется в модуле requester.py

При нажатии команды start в клиенте telegram отправляется приветственное 
сообщение а также появляется клавиатура с доступными командами

Команды:

    /start - базовая команда, запускает диалог с ботом
    
    /help - Выводит список доступных команд и их краткое описание
    
    /lowest_price - запускает диалог для сбора данных, необходимых для 
                    получения отелей по самой низкой цене
    
    /highest_price - запускает диалог для сбора данных, необходимых для 
                    получения отелей по самой высокой цене
    
    /history - запускает диалог для сбора параметров вывода истории запросов
    
    /best_deal - запускает диалог для сбора данных, необходимых для 
                    получения отелей в выбранном ценовом диапазоне и удалении 
                    от центра
    
    /back - прерывает любую команду и возвращает в меню выбора команд

Вызов любой команды во время исполнения другой очищает кэш память и 
запускает новую команду (в отличие от /back, которая чистит кэш, но не 
запускает других команд)

Отправка сообщения вне сбора параметров, которое не опознанно как команда, 
приведет к отправке "эхо" сообщения
При сборе параметров запроса применяются регулярные выражения, хоть и на 
базовом уровне


Тех долг:
* в опроснике доработать логику так, чтобы при ответе на вопрос "Do you 
  need photos?" при варианте "No", количество фотографий не спрашивалось